!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((r=r||self).popmotion={})}(this,function(r){"use strict";var k=function(){return(k=Object.assign||function(r){for(var t,n=1,e=arguments.length;n<e;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a]);return r}).apply(this,arguments)};function C(r){var t=r.from,i=void 0===t?0:t,n=r.to,f=void 0===n?0:n,e=r.velocity,s=void 0===e?0:e,a=r.stiffness,c=void 0===a?100:a,o=r.damping,p=void 0===o?10:o,u=r.mass,v=void 0===u?1:u,d=r.restSpeed,l=void 0===d?2:d,h=r.restDelta,m={done:!1,value:i},y=b,g=b;function M(){var n,e=s?-s/1e3:0,a=f-i,o=p/(2*Math.sqrt(c*v)),u=Math.sqrt(c/v)/1e3;null!=h||(h=Math.abs(f-i)<=1?.01:.4),o<1?(y=function(r){var t=Math.exp(-o*u*r),n=u*Math.sqrt(1-o*o);return f-t*((e+o*u*a)/n*Math.sin(n*r)+a*Math.cos(n*r))},g=function(r){var t=Math.exp(-o*u*r),n=u*Math.sqrt(1-o*o);return o*u*t*(Math.sin(n*r)*(e+o*u*a)/n+a*Math.cos(n*r))-t*(Math.cos(n*r)*(e+o*u*a)-n*a*Math.sin(n*r))}):y=1==o?function(r){var t=Math.exp(-u*r);return f-t*(a+(e+u*a)*r)}:(n=u*Math.sqrt(o*o-1),function(r){var t=Math.exp(-o*u*r);return f-t*((e+o*u*a)*Math.sinh(n*r)+n*a*Math.cosh(n*r))/n})}return M(),{next:function(r){var t=y(r),n=1e3*g(r),e=Math.abs(n)<=l,a=Math.abs(f-t)<=h;return m.done=e&&a,m.value=m.done?f:t,m},flipTarget:function(){var r;s=-s,i=(r=[f,i])[0],f=r[1],M()}}}C.needsInterpolation=function(r,t){return"string"==typeof r||"string"==typeof t};function f(r,t,n){return-n*r+n*t+r}function t(t,n){return function(r){return Math.max(Math.min(r,n),t)}}function p(r){return r%1?Number(r.toFixed(5)):r}function n(r){return void 0!==r.red}function e(r){return void 0!==r.hue}var a,b=function(r){return 0},x=function(r,t,n){var e=t-r;return 0==e?1:(n-r)/e},s=/(-)?(\d[\d\.]*)/g,c=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,o=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i,u={test:function(r){return"number"==typeof r},parse:parseFloat,transform:function(r){return r}},v=k(k({},u),{transform:t(0,1)}),d=(k(k({},u),{default:1}),a="%",{test:function(r){return"string"==typeof r&&r.endsWith(a)&&1===r.split(" ").length},parse:parseFloat,transform:function(r){return""+r+a}}),i=(k(k({},d),{parse:function(r){return d.parse(r)/100},transform:function(r){return d.transform(100*r)}}),t(0,255));function l(o){return function(r){if("string"!=typeof r)return r;for(var t,n={},e=(t=r).substring(t.indexOf("(")+1,t.lastIndexOf(")")).replace(/(,|\/)/g," ").split(/ \s*/),a=0;a<4;a++)n[o[a]]=void 0!==e[a]?parseFloat(e[a]):1;return n}}var h=k(k({},u),{transform:function(r){return Math.round(i(r))}});function m(r,t){return r.startsWith(t)&&o.test(r)}function y(r){return"number"==typeof r?0:r}function g(r,t,n){var e=r*r,a=t*t;return Math.sqrt(Math.max(0,n*(a-e)+e))}function M(t){return F.find(function(r){return r.test(t)})}function O(r){return"number"==typeof r}function w(t,n){return function(r){return n(t(r))}}var A={test:function(r){return"string"==typeof r?m(r,"rgb"):n(r)},parse:l(["red","green","blue","alpha"]),transform:function(r){var t,n,e,a,o,u=r.red,i=r.green,f=r.blue,s=r.alpha,c=void 0===s?1:s;return t={red:h.transform(u),green:h.transform(i),blue:h.transform(f),alpha:p(v.transform(c))},n=t.red,e=t.green,a=t.blue,o=t.alpha,"rgba("+n+", "+e+", "+a+", "+(void 0===o?1:o)+")"}},I={test:function(r){return"string"==typeof r?m(r,"hsl"):e(r)},parse:l(["hue","saturation","lightness","alpha"]),transform:function(r){var t,n,e,a,o,u=r.hue,i=r.saturation,f=r.lightness,s=r.alpha,c=void 0===s?1:s;return t={hue:Math.round(u),saturation:d.transform(p(i)),lightness:d.transform(p(f)),alpha:p(v.transform(c))},n=t.hue,e=t.saturation,a=t.lightness,o=t.alpha,"hsla("+n+", "+e+", "+a+", "+(void 0===o?1:o)+")"}},P=k(k({},A),{test:function(r){return"string"==typeof r&&m(r,"#")},parse:function(r){var t="",n="",e="";return 4<r.length?(t=r.substr(1,2),n=r.substr(3,2),e=r.substr(5,2)):(t=r.substr(1,1),n=r.substr(2,1),e=r.substr(3,1),t+=t,n+=n,e+=e),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(e,16),alpha:1}}}),T={test:function(r){return"string"==typeof r&&o.test(r)||n(r)||e(r)},parse:function(r){return A.test(r)?A.parse(r):I.test(r)?I.parse(r):P.test(r)?P.parse(r):r},transform:function(r){return n(r)?A.transform(r):e(r)?I.transform(r):r}},D="${c}",S="${n}",j={test:function(r){if("string"!=typeof r||!isNaN(r))return!1;var t=0,n=r.match(s),e=r.match(c);return n&&(t+=n.length),e&&(t+=e.length),0<t},parse:function(r){var t=r,n=[],e=t.match(c);e&&(t=t.replace(c,D),n.push.apply(n,e.map(T.parse)));var a=t.match(s);return a&&n.push.apply(n,a.map(u.parse)),n},createTransformer:function(r){var e=r,a=0,t=r.match(c),o=t?t.length:0;if(t)for(var n=0;n<o;n++)e=e.replace(t[n],D),a++;var u=e.match(s),i=u?u.length:0;if(u)for(n=0;n<i;n++)e=e.replace(u[n],S),a++;return function(r){for(var t=e,n=0;n<a;n++)t=t.replace(n<o?D:S,n<o?T.transform(r[n]):p(r[n]));return t}},getAnimatableNone:function(r){var t=j.parse(r);return j.createTransformer(r)(t.map(y))}},q=function(){},F=[P,A,I],E=function(r,t){var n=M(r),e=M(t);q(n.transform===e.transform);var a=n.parse(r),o=e.parse(t),u=k({},a),i=n===I?f:g;return function(r){for(var t in u)"alpha"!==t&&(u[t]=i(a[t],o[t],r));return u.alpha=f(a.alpha,o.alpha,r),n.transform(u)}},R={x:0,y:0,z:0},U=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return r.reduce(w)};function z(t,n){return O(t)?function(r){return f(t,n,r)}:(T.test(t)?E:$)(t,n)}var N=function(r,n){var e=function(){for(var r=0,t=0,n=arguments.length;t<n;t++)r+=arguments[t].length;for(var e=Array(r),a=0,t=0;t<n;t++)for(var o=arguments[t],u=0,i=o.length;u<i;u++,a++)e[a]=o[u];return e}(r),a=e.length,o=r.map(function(r,t){return z(r,n[t])});return function(r){for(var t=0;t<a;t++)e[t]=o[t](r);return e}},W=function(r,t){var n=k(k({},r),t),e={};for(var a in n)void 0!==r[a]&&void 0!==t[a]&&(e[a]=z(r[a],t[a]));return function(r){for(var t in e)n[t]=e[t](r);return n}};function B(r){for(var t=j.parse(r),n=t.length,e=0,a=0,o=0,u=0;u<n;u++)e||"number"==typeof t[u]?e++:void 0!==t[u].hue?o++:a++;return{parsed:t,numNumbers:e,numRGB:a,numHSL:o}}var $=function(r,t){var n=j.createTransformer(t),e=B(r),a=B(t);return U(N(e.parsed,a.parsed),n)},_=function(r,t,n){return Math.min(Math.max(n,r),t)},G=function(t,n){return function(r){return f(t,n,r)}};function H(r,t,n){for(var e,a=[],o=n||("number"==typeof(e=r[0])?G:"string"==typeof e?T.test(e)?E:$:Array.isArray(e)?N:"object"==typeof e?W:void 0),u=r.length-1,i=0;i<u;i++){var f,s=o(r[i],r[i+1]);t&&(f=Array.isArray(t)?t[i]:t,s=U(f,s)),a.push(s)}return a}function L(t,r,n){var e=void 0===n?{}:n,a=e.clamp,o=void 0===a||a,u=e.ease,i=e.mixer,f=t.length;q(f===r.length),q(!u||!Array.isArray(u)||u.length===f-1),t[0]>t[f-1]&&(t=[].concat(t),r=[].concat(r),t.reverse(),r.reverse());var s,c,p,v,d,l,h,m,y,g=H(r,u,i),M=2===f?(l=g,h=(d=t)[0],m=d[1],y=l[0],function(r){return y(x(h,m,r))}):(c=g,p=(s=t).length,v=p-1,function(r){var t=0,n=!1;if(r<=s[0]?n=!0:r>=s[v]&&(t=v-1,n=!0),!n){for(var e=1;e<p&&!(s[e]>r||e===v);e++);t=e-1}var a=x(s[t],s[t+1],r);return c[t](a)});return o?function(r){return M(_(t[0],t[f-1],r))}:M}function V(t){return function(r){return 1-t(1-r)}}function J(t){return function(r){return r<=.5?t(2*r)/2:(2-t(2*(1-r)))/2}}function K(t){return function(r){return Math.pow(r,t)}}function Q(t){return function(r){return r*r*((t+1)*r-t)}}function X(r){var t=Q(r);return function(r){return(r*=2)<1?.5*t(r):.5*(2-Math.pow(2,-10*(r-1)))}}function Y(r){return r}function Z(r){return 1-Math.sin(Math.acos(r))}function rr(r){if(1===r||0===r)return r;var t=r*r;return r<4/11?7.5625*t:r<8/11?9.075*t-9.9*r+3.4:r<.9?4356/361*t-35442/1805*r+16061/1805:10.8*r*r-20.52*r+10.72}var tr=K(2),nr=V(tr),er=J(tr),ar=V(Z),or=J(ar),ur=Q(1.525),ir=V(ur),fr=J(ur),sr=X(1.525),cr=V(rr);function pr(r){var t,n,e,a,o=r.from,u=void 0===o?0:o,i=r.to,f=void 0===i?1:i,s=r.ease,c=r.offset,p=r.duration,v=void 0===p?300:p,d={done:!1,value:u},l=Array.isArray(f)?f:[u,f],h=(t=null!=c?c:(a=(e=l).length,e.map(function(r,t){return 0!==t?t/(a-1):0})),n=v,t.map(function(r){return r*n}));function m(){return L(h,l,{ease:Array.isArray(s)?s:(t=s,(r=l).map(function(){return t||er}).splice(0,r.length-1))});var r,t}var y=m();return{next:function(r){return d.value=y(r),d.done=v<=r,d},flipTarget:function(){l.reverse(),y=m()}}}function vr(r){var t=r.velocity,n=void 0===t?0:t,e=r.from,a=void 0===e?0:e,o=r.power,u=void 0===o?.8:o,i=r.timeConstant,f=void 0===i?350:i,s=r.restDelta,c=void 0===s?.5:s,p=r.modifyTarget,v={done:!1,value:a},d=u*n,l=a+d,h=void 0===p?l:p(l);return h!==l&&(d=h-a),{next:function(r){var t=-d*Math.exp(-r/f);return v.done=!(c<t||t<-c),v.value=v.done?h:h+t,v},flipTarget:function(){}}}var dr={keyframes:pr,spring:C,decay:vr};function lr(r){return br=r}function hr(r){return Ar[r].process(Or)}var mr=0,yr="undefined"!=typeof window&&void 0!==window.requestAnimationFrame?function(r){return window.requestAnimationFrame(r)}:function(r){var t=Date.now(),n=Math.max(0,16.7-(t-mr));mr=t+n,setTimeout(function(){return r(mr)},n)},gr=1/60*1e3,Mr=!0,br=!1,xr=!1,Or={delta:0,timestamp:0},wr=["read","update","preRender","render","postRender"],Ar=wr.reduce(function(r,t){var e,o,u,i,f,a,s,c,p;return r[t]=(e=lr,o=[],f=!(u=[]),a=i=0,s=new WeakSet,c=new WeakSet,p={cancel:function(r){var t=u.indexOf(r);s.add(r),-1!==t&&u.splice(t,1)},process:function(r){var t,n;if(f=!0,o=(t=[u,o])[0],(u=t[1]).length=0,i=o.length)for(a=0;a<i;a++)(n=o[a])(r),!0!==c.has(n)||s.has(n)||(p.schedule(n),e(!0));f=!1},schedule:function(r,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var e=n&&f,a=e?o:u;s.delete(r),t&&c.add(r),-1===a.indexOf(r)&&(a.push(r),e&&(i=o.length))}}),r},{}),Ir=wr.reduce(function(r,t){var e=Ar[t];return r[t]=function(r,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),br||Dr(),e.schedule(r,t,n),r},r},{}),Pr=wr.reduce(function(r,t){return r[t]=Ar[t].cancel,r},{}),Tr=function(r){br=!1,Or.delta=Mr?gr:Math.max(Math.min(r-Or.timestamp,40),1),Mr||(gr=Or.delta),Or.timestamp=r,xr=!0,wr.forEach(hr),xr=!1,br&&(Mr=!1,yr(Tr))},Dr=function(){Mr=br=!0,xr||yr(Tr)};function Sr(r,t,n){return void 0===n&&(n=0),r-t-n}var jr=function(n){function r(r){var t=r.delta;return n(t)}return{start:function(){return Ir.update(r,!0,!0)},stop:function(){return Pr.update(r)}}};function qr(r){var t,o,u,i,n=r.from,e=r.autoplay,a=void 0===e||e,f=r.driver,s=void 0===f?jr:f,c=r.elapsed,p=void 0===c?0:c,v=r.repeat,d=void 0===v?0:v,l=r.repeatType,h=void 0===l?"loop":l,m=r.repeatDelay,y=void 0===m?0:m,g=r.onPlay,M=r.onStop,b=r.onComplete,x=r.onRepeat,O=r.onUpdate,w=function(r,t){var n={};for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&t.indexOf(e)<0&&(n[e]=r[e]);if(null!=r&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,e=Object.getOwnPropertySymbols(r);a<e.length;a++)t.indexOf(e[a])<0&&Object.prototype.propertyIsEnumerable.call(r,e[a])&&(n[e[a]]=r[e[a]]);return n}(r,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),A=w.to,I=0,P=w.duration,T=!1,D=!0,S=function(r){if(Array.isArray(r.to))return pr;if(dr[r.type])return dr[r.type];var t=new Set(Object.keys(r));return!t.has("ease")&&!t.has("duration")&&(t.has("stiffness")||t.has("mass")||t.has("damping")||t.has("restSpeed")||t.has("restDelta"))?C:pr}(w);null!==(t=S.needsInterpolation)&&void 0!==t&&t.call(S,n,A)&&(i=L([0,100],[n,A],{clamp:!1}),n=0,A=100);var j=S(k(k({},w),{from:n,to:A}));function q(){var r,t,n,e;I++,"reverse"===h?(r=p,t=P,void 0===(n=y)&&(n=0),void 0===(e=D=I%2==0)&&(e=!0),p=e?Sr(t+-r,t,n):t-(r-t)+n):(p=Sr(p,P,y),"mirror"===h&&j.flipTarget()),T=!1,x&&x()}function F(r){var t,n,e,a;D||(r=-r),p+=r,T||(t=j.next(Math.max(0,p)),u=t.value,i&&(u=i(u)),T=D?t.done:p<=0),null!=O&&O(u),T&&(0===I&&(null!=P||(P=p)),I<d?(n=p,e=P,a=y,(D?e+a<=n:n<=-a)&&q()):(o.stop(),b&&b()))}return a&&(null!=g&&g(),(o=s(F)).start()),{stop:function(){null!=M&&M(),o.stop()}}}function Fr(r,t){return t?r*(1e3/t):0}function kr(r){return 180*r/Math.PI}function Cr(r){return r}function Er(o){return void 0===o&&(o=Cr),function(r,t,n){var e=t-n,a=-(0-r+1)*(0-o(Math.abs(e)));return e<=0?t+a:t-a}}function Rr(r){return r*Math.PI/180}function Ur(r){return r.hasOwnProperty("x")&&r.hasOwnProperty("y")}function zr(r){return Ur(r)&&r.hasOwnProperty("z")}function Nr(r,t){return Math.abs(r-t)}var Wr=Er(),Br=Er(Math.sqrt);function $r(r,t){return void 0===t&&(t=2),t=Math.pow(10,t),Math.round(r*t)/t}function _r(r,t,n,e){return void 0===e&&(e=0),$r(r+n*(t-r)/Math.max(e,n))}function Gr(r,t){return 1-3*t+3*r}function Hr(r,t){return 3*t-6*r}var Lr=function(r,t,n){return((Gr(t,n)*r+Hr(t,n))*r+3*t)*r},Vr=function(r,t,n){return 3*Gr(t,n)*r*r+2*Hr(t,n)*r+3*t},Jr=1e-7,Kr=10;var Qr=8;r.angle=function(r,t){return void 0===t&&(t=R),kr(Math.atan2(t.y-r.y,t.x-r.x))},r.animate=qr,r.anticipate=sr,r.applyOffset=function(t,n){var e=!0;return void 0===n&&(n=t,e=!1),function(r){return e?r-t+n:(t=r,e=!0,n)}},r.attract=Wr,r.attractExpo=Br,r.backIn=ur,r.backInOut=fr,r.backOut=ir,r.bounceIn=cr,r.bounceInOut=function(r){return r<.5?.5*(1-rr(1-2*r)):.5*rr(2*r-1)+.5},r.bounceOut=rr,r.circIn=Z,r.circInOut=or,r.circOut=ar,r.clamp=_,r.createAnticipate=X,r.createAttractor=Er,r.createBackIn=Q,r.createExpoIn=K,r.cubicBezier=function(o,t,u,n){if(o===t&&u===n)return Y;for(var i=new Float32Array(11),r=0;r<11;++r)i[r]=Lr(.1*r,o,u);function e(r){for(var t=0,n=1;10!==n&&i[n]<=r;++n)t+=.1;var e=t+.1*((r-i[--n])/(i[n+1]-i[n])),a=Vr(e,o,u);return.001<=a?function(r,t,n,e){for(var a=0;a<Qr;++a){var o=Vr(t,n,e);if(0===o)return t;t-=(Lr(t,n,e)-r)/o}return t}(r,e,o,u):0===a?e:function(r,t,n,e,a){for(var o,u,i=0;0<(o=Lr(u=t+(n-t)/2,e,a)-r)?n=u:t=u,Math.abs(o)>Jr&&++i<Kr;);return u}(r,t,t+.1,o,u)}return function(r){return 0===r||1===r?r:Lr(e(r),t,n)}},r.decay=vr,r.degreesToRadians=Rr,r.distance=function(r,t){if(O(r)&&O(t))return Nr(r,t);if(Ur(r)&&Ur(t)){var n=Nr(r.x,t.x),e=Nr(r.y,t.y),a=zr(r)&&zr(t)?Nr(r.z,t.z):0;return Math.sqrt(Math.pow(n,2)+Math.pow(e,2)+Math.pow(a,2))}},r.easeIn=tr,r.easeInOut=er,r.easeOut=nr,r.inertia=function(r){var t,n,e,a,o,u,i=r.from,f=void 0===i?0:i,s=r.velocity,c=void 0===s?0:s,p=r.min,v=r.max,d=r.power,l=void 0===d?.8:d,h=r.timeConstant,m=void 0===h?750:h,y=r.bounceStiffness,g=void 0===y?500:y,M=r.bounceDamping,b=void 0===M?10:M,x=r.restDelta,O=void 0===x?1:x,w=r.modifyTarget,A=r.driver,I=r.onUpdate,P=r.onComplete;function T(r){return void 0!==p&&r<p||void 0!==v&&v<r}function D(r){return void 0!==p&&(void 0===v||Math.abs(p-r)<Math.abs(v-r))?p:v}function S(n){null!=t&&t.stop(),t=qr(k(k({},n),{driver:A,onUpdate:function(r){var t;null!=I&&I(r),null!==(t=n.onUpdate)&&void 0!==t&&t.call(n,r)},onComplete:P}))}function j(r){S(k({type:"spring",stiffness:g,damping:b,restDelta:O},r))}return T(f)?j({from:f,velocity:c,to:D(f)}):(n=l*c+f,void 0!==w&&(n=w(n)),e=D(n),a=e===p?-1:1,S({type:"decay",from:f,velocity:c,timeConstant:m,power:l,restDelta:O,modifyTarget:w,onUpdate:T(n)?function(r){o=u,c=Fr((u=r)-o,Or.delta),(1==a&&e<r||-1==a&&r<e)&&j({from:r,to:e,velocity:c})}:void 0})),{stop:function(){return null==t?void 0:t.stop()}}},r.interpolate=L,r.isPoint=Ur,r.isPoint3D=zr,r.keyframes=pr,r.linear=Y,r.mirrorEasing=J,r.mix=f,r.mixColor=E,r.mixComplex=$,r.pipe=U,r.pointFromVector=function(r,t,n){return t=Rr(t),{x:n*Math.cos(t)+r.x,y:n*Math.sin(t)+r.y}},r.progress=x,r.radiansToDegrees=kr,r.reverseEasing=V,r.smooth=function(a){void 0===a&&(a=50);var o=0,u=0;return function(r){var t=Or.timestamp,n=t!==u?t-u:0,e=n?_r(o,r,n,a):o;return u=t,o=e}},r.smoothFrame=_r,r.snap=function(a){if("number"==typeof a)return function(r){return Math.round(r/a)*a};var o=0,u=a.length;return function(r){var t=Math.abs(a[0]-r);for(o=1;o<u;o++){var n=a[o],e=Math.abs(n-r);if(0===e)return n;if(t<e)return a[o-1];if(o===u-1)return n;t=e}}},r.spring=C,r.steps=function(e,a){return void 0===a&&(a="end"),function(r){var t=(r="end"===a?Math.min(r,.999):Math.max(r,.001))*e,n="end"===a?Math.floor(t):Math.ceil(t);return _(0,1,n/e)}},r.toDecimal=$r,r.velocityPerFrame=function(r,t){return r/(1e3/t)},r.velocityPerSecond=Fr,r.wrap=function(r,t,n){var e=t-r;return((n-r)%e+e)%e+r},Object.defineProperty(r,"__esModule",{value:!0})});
